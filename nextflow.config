manifest {
    author            = 'Trevor F. Freeman'
    defaultBranch     = 'main'
    recurseSubmodules = true
    description       = 'A pipeline for ATAC-seq data analysis built on SRAlign.'
    mainScript        = 'main.nf'
    name              = 'trev-f/SRAtac'
    nextflowVersion   = '>=21.04'
    version           = '0.3.2'
}

params {
    /*
    I/O
    */

    // Input
    baseDirGenome = "${PWD}/data/references"

    // Output
    baseDirReport = "${PWD}/results/reports"
    baseDirData   = "${PWD}/results/data"

    // Full MultiQC
    multiqcConfig = "$projectDir/configs/full_multiqc_config.yaml"

    contaminant = 'EB1'

    help = null

    /*
    Raw reads QC
    */
    skipRawFastQC = false

    /*
    Trim reads and QC
    */
    trimTool = 'fastp'

    // Read-trimming control flow
    skipTrimReads   = false
    skipTrimReadsQC = false
    
    adapterR1 = 'CTGTCTCTTATACACATCT'
    adapterR2 = false

    /*
    Align
    */
    alignmentTool = 'bowtie2'

    // Alignment control flow
    forceAlignRawReads = false
    skipAlignGenome = false

    // Alignment stats
    skipSamStatsQC = false
    
    // Check contamination
    skipAlignContam = false

    // preseq
    skipPreseq = false

    // filtering
    skipFilterBam = false
    mappingQualityThreshold = '10'
    forceUnfilteredBam = false

    // bamCoverage
    skipBamCoverage = false
    binSize         = 50
    normMethod      = 'None'

    // peak calling
    skipPeakCalling = false

    // merge peaks
    skipMergePeaks = false
    mergePeaksTool = 'homer'
}


profiles {
    docker {
        docker.enabled = true
    }
    google {
        process.executor = 'google-lifesciences'
        workDir          = 'gs://esctffno/scratch'
        google.location  = 'us-central1'
        google.region    = 'us-central1'
        google.project   = 'no-chr'
    }
    test {
        docker.enabled     = true
        params.input       = "${projectDir}/test/data/inputs/ATAC_PE_design.csv"
        params.genome      = 'testWBcel235'
        params.contaminant = 'testEB1'
    }
    testBam {
        docker.enabled     = true
        params.input       = "${projectDir}/test/data/inputs/ATAC_PE_design_bam.csv"
        params.genome      = 'testWBcel235'
        params.contaminant = 'testEB1'
    }
}


/*
    Include other config files
*/

// Load genomes config file
includeConfig 'configs/genomes.config'

// Load modules config file
includeConfig 'configs/modules.config'

// Load resources config file
includeConfig 'configs/resources.config'


/*
    Reporting
*/

timestamp = new java.util.Date().format('yyyy-MM-dd_HH-mm')

dag {
    enabled = true
    file    = "${params.baseDirReport}/tracing/${timestamp}_dag.html"
}

report {
    enabled = true
    file    = "${params.baseDirReport}/tracing/${timestamp}_report.html"
}


timeline{
    enabled = true
    file    = "${params.baseDirReport}/tracing/${timestamp}_timeline.html"
}


trace {
    enabled = true
    file    = "${params.baseDirReport}/tracing/${timestamp}_trace.html"
}
